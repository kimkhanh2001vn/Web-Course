
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khóa học xây dựng</title>

    <!-- Style CSS -->
    <link rel="stylesheet" type="text/css" href="~/Assets/Client/css/style.css">
    <link href="~/Resources/css/fonts/CardPosts.css" rel="stylesheet" />
    <link href="~/css/collapsible.css" rel="stylesheet" />

</head>
<body>
    <div class="cms-index-index index-opt-1">
        <div class="wrapper">
            @Html.Partial("_Uudai")
            @Html.Partial("_Menu")

        </div>
        <div>
            @RenderBody()
        </div>
        <div>
            @Html.Partial("_Footer")
        </div>
    </div>


    <!-- jQuery -->
    <script type="text/javascript" src="/Resources/MainPage/js/jquery.min.js"></script>

    <!-- sticky -->
    <script type="text/javascript" src="/Resources/MainPage/js/jquery.sticky.js"></script>

    <!-- OWL CAROUSEL Slider -->
    <script type="text/javascript" src="/Resources/MainPage/js/owl.carousel.min.js"></script>

    <!-- Boostrap -->
    <script type="text/javascript" src="/Resources/MainPage/js/bootstrap.min.js"></script>

    <!-- Countdown -->
    <script type="text/javascript" src="/Resources/MainPage/js/jquery.countdown.min.js"></script>

    <!--jquery Bxslider  -->
    <script type="text/javascript" src="/Resources/MainPage/js/jquery.bxslider.min.js"></script>

    <!-- actual -->
    <script type="text/javascript" src="/Resources/MainPage/js/jquery.actual.min.js"></script>

    <!-- Chosen jquery-->
    <script type="text/javascript" src="/Resources/MainPage/js/chosen.jquery.min.js"></script>

    <!-- parallax jquery-->
    <script type="text/javascript" src="/Resources/MainPage/js/jquery.parallax-1.1.3.js"></script>

    <!-- elevatezoom -->
    <script type="text/javascript" src="/Resources/MainPage/js/jquery.elevateZoom.min.js"></script>

    <!-- fancybox -->
    <script src="js/fancybox/source/jquery.fancybox.pack.js"></script>
    <script src="js/fancybox/source/helpers/jquery.fancybox-media.js"></script>
    <script src="js/fancybox/source/helpers/jquery.fancybox-thumbs.js"></script>

    <!-- arcticmodal -->
    <script src="/Resources/MainPage/js/arcticmodal/jquery.arcticmodal.js"></script>

    <!-- Main -->
    <script type="text/javascript" src="/Resources/MainPage/js/main.js"></script>

    <script src="/js/jquery-2.2.3.min.js"></script>
    <script type='text/javascript' src="/js/bootstrap.min.js"></script>
    <script type='text/javascript' src="/js/jquery.mycart.js"></script>

    <script src="/js/storesCartItems.js"></script>


    <div id="myModal" class="modal fade" role="dialog" style="z-index: 99999999">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header" style="background-color:#0094ff">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title" style="color:white"></h4>
                </div>
                <div class="modal-body">

                    <form data-toggle="validator" role="form">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label for="inputName" class="control-label">Tên khách hàng</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><span class="glyphicon glyphicon-user" style="color:cornflowerblue;"></span></div>
                                    <input type="text" class="form-control" id="txtCustomer" placeholder="Tên khách hàng" data-error="Tên khách hàng không bỏ trống" required>

                                </div>

                                <div class="help-block with-errors"></div>
                            </div>
                            <div class="form-group">
                                <label for="inputName" class="control-label">Địa chỉ</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><span class="glyphicon glyphicon-book" style="color:cornflowerblue;"></span></div>
                                    <input type="text" class="form-control" id="txtAddRess" onkeyup="changetext()" placeholder="Địa chỉ" data-error="Địa chỉ không bỏ trống" required>


                                </div>
                                <div class="help-block with-errors"></div>
                            </div>
                            <div class="form-group has-feedback">
                                <label for="inputTwitter" class="control-label">Số điện thoại</label>
                                <div class="input-group">
                                    <div class="input-group-addon"><span class="glyphicon glyphicon-phone" style="color:cornflowerblue;"></span></div>
                                    <input type="text" pattern="^[_0-9]{1,}$" class="form-control" id="txtPhoneNumbers" placeholder="Số điện thoại" data-error="Điện thoại phải là chữ số" required>

                                </div>
                                <div class="help-block with-errors"></div>
                            </div>
                            <div class="form-group">
                                <label for="inputEmail" class="control-label">Email</label>


                                <div class="input-group">
                                    <div class="input-group-addon"><span class="glyphicon glyphicon-envelope" style="color:cornflowerblue;"></span></div>
                                    <input type="email" class="form-control" id="txtEmail" placeholder="Email" data-error="Địa chỉ email không hợp lệ" required>

                                </div>





                                <div class="help-block with-errors"></div>
                            </div>
                        </div>
                        <div class="col-sm-6"></div>
                        <div id="dvDistance"></div>
                        <div id="dvDistance1"></div>
                        <div id="dvDistance2"></div>
                        <div id="dvMap" style="min-height:300px">
                        </div>


                    </form>
                    <div class="row">
                        <div class="form-group col-sm-6" style="width:200px; margin-left:100px">
                            <button type="submit" onclick="sendCustomerInformation();" data-dismiss="modal" class="btn btn-primary">Thanh toán</button>
                        </div>
                        <div class="col-sm-3" style="width:200px">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">Hủy bỏ</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">

                </div>
            </div>

        </div>
    </div>
    <script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyAixSrDX8oJvGo3FyTQLr3hypZyXA-coiQ" type="text/javascript"></script>

    <script>
        var changetext = function () {
            directionsDisplay.setMap(map);

            // source = document.getElementById("travelfrom").value;
            source = "89C Nguyễn Thượng Hiền Phường 5 Quận Bình Thạnh,tphcm";
            destination = document.getElementById("txtAddRess").value;

            var request = {
                origin: source,
                destination: destination,
                travelMode: google.maps.TravelMode.DRIVING
            };

            directionsService.route(request, function (response, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setDirections(response);
                }
            });

            //*********DISTANCE AND DURATION**********************//
            var service = new google.maps.DistanceMatrixService();
            service.getDistanceMatrix({
                origins: [source],
                destinations: [destination],
                travelMode: google.maps.TravelMode.DRIVING,
                unitSystem: google.maps.UnitSystem.METRIC,
                avoidHighways: false,
                avoidTolls: false
            }, function (response, status) {

                if (status == google.maps.DistanceMatrixStatus.OK && response.rows[0].elements[0].status != "ZERO_RESULTS") {
                    var distance = response.rows[0].elements[0].distance.text;
               //     try {
                          @{
             //   Session["distance"] = @:distance + "";
             }
                      //  Session["distance"] ;
                           @*@foreach(var distance in ShipRates)
            {
                if (Session["distance"] != null) {

                    if (double.Parse(Session["distance"].ToString()) == double.Parse(distance.FromDes + "") && double.Parse(Session["distance"].ToString()) <= double.Parse(distance.ToDes + "")) {
                        Session["distance"] = distance.ShipRate;
                    }

                }
            }*@




                    //} catch (err) {

                    //}


                    var duration = response.rows[0].elements[0].duration.value;
                    var dvDistance = document.getElementById("dvDistance");
                    var shipmoney = response.rows[0].elements[0].distance.value;

                    //var money = shipmoney.split(' ');
                    shipmoney = parseInt(shipmoney*4/1000+0.5)*1000;

                    duration = parseFloat(duration / 60).toFixed(2);
                    var total = parseFloat(sessionStorage["Products"]) + shipmoney;
                    dvDistance1.innerHTML = "Khoảng cách: " + distance + "<br />";

                    dvDistance.innerHTML = "Tiền ship: " + shipmoney.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,") + "<br />";
                    dvDistance2.innerHTML = "Tổng(bao gồm ship): " + Math.round(total,0).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,") + "<br />";

                    var ShipRate = [];
                    ShipRate.push({
                        distance: distance,
                        shipmoney: shipmoney,
                        totalmoney: total

                    });
                    var shipRate = ShipRate;
                    var t = JSON.stringify(shipRate);
                    $.ajax({
                        url: '/CartItems/getShip',  //this is the umbraco surface path to controller action. problem her!!!!

                        type: "POST",
                        data: JSON.stringify({ shiprate: t }),
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        error: function (jqXHR, textStatus, errorThrown) {

                        },
                        success: function (data, textStatus, jqXHR) {
                            // alert("Bạn đã hoàn tất đơn hàng");
                        }
                    })
                //    dvDistance.innerHTML = "Time:" + duration + " min";
                 //   dvDistance.innerHTML = "ShipRate" + Session["distance"];
                } else {
                    //alert("");
                }
            });
        };

        var source, destination;
        var directionsDisplay;
        var directionsService = new google.maps.DirectionsService();
        //     10.811123, 106.684974
        // initialise the location of the map on Chichester in England (ref lat and lng)
        var map = new google.maps.Map(document.getElementById('dvMap'), {
            center: { lat: 10.811123, lng: 106.684974 },
            zoom: 13,
            mapTypeId: 'roadmap'
        });

        google.maps.event.addDomListener(window, 'load', function () {

           // new google.maps.places.SearchBox(document.getElementById('travelfrom'));
            new google.maps.places.SearchBox("44 nguyễn thông, quận 3,tphcm");
            new google.maps.places.SearchBox(document.getElementById('txtAddress'));
            directionsDisplay = new google.maps.DirectionsRenderer({ 'draggable': true });
        });
    </script>

    @RenderSection("head", required: false)
</body>

</html>
